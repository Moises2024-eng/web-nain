<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Formulario Completo - WEB NAIN</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="css/style.css">
  
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
</head>
<body>

<input type="hidden" name="fecha_reporte" id="fecha_reporte_input">

<section id="contenedor-dinamico" class="contacto">
  <form class="formulario" id="form-reclamo">
    <input type="hidden" name="fecha_reporte" id="fecha_reporte_input">

    <h1 id="titulo-formulario">Formulario</h1>
    <p id="fecha-formulario"></p>

    <div id="seccion-uv24" class="encuesta-likert" style="display:none; border-left:5px solid #a5d8ff;">
        <h3>Contenido Especial UV 24</h3>
        <p>Preguntas exclusivas para la Unidad Vecinal 24.</p>
    </div>
    <div id="seccion-uv25" class="encuesta-likert" style="display:none; border-left:5px solid #b2f2bb;">
        <h3>Contenido Especial UV 25</h3>
        <p>Preguntas exclusivas para la Unidad Vecinal 25.</p>
    </div>
    <div id="seccion-uv26" class="encuesta-likert" style="display:none; border-left:5px solid #ffd8a8;">
        <h3>Contenido Especial UV 26</h3>
        <p>Preguntas exclusivas para la Unidad Vecinal 26.</p>
    </div>

    <div class="encuesta-seccion">
        <input type="text" name="nombre" placeholder="Nombre" required>
        <input type="text" name="apellido" placeholder="Apellido" required>
        <input type="email" name="user_email" placeholder="Correo" required>
        <textarea name="mensaje" placeholder="Mensaje adicional..." required></textarea>
    </div>

    <div class="encuesta-seccion" id="seccion-horas">
        <h3>Solicitud de Hora de Atenci贸n</h3>
        <p id="instruccion-horario" class="instruccion">Seleccione su bloque:</p>
        <div id="contenedor-grid-horas" class="contenedor-grid-horas"></div>
    </div>

    <p class="leyenda-encuesta">(1- MUY EN DESACUERDO) (2. EN DESACUERDO) (3- DE ACUERDO) (4- MUY DE ACUERDO)</p>

    <div class="encuesta-likert">
    <h3>1. Evaluaci贸n de Seguridad y Convivencia</h3>
    <div class="tabla-responsiva">
        <table>
            <thead><tr><th>Afirmaci贸n</th><th>1</th><th>2</th><th>3</th><th>4</th></tr></thead>
            <tbody>
                <tr><td>Prevenci贸n: Red de comunicaci贸n r谩pida frente a delitos.</td>
                    <td><input type="radio" name="seg_prevencion" value="Muy en desacuerdo" required></td>
                    <td><input type="radio" name="seg_prevencion" value="En desacuerdo"></td>
                    <td><input type="radio" name="seg_prevencion" value="De acuerdo"></td>
                    <td><input type="radio" name="seg_prevencion" value="Muy de acuerdo"></td></tr>
                <tr><td>Confianza: Vecinos acuden para resolver problemas.</td>
                    <td><input type="radio" name="seg_confianza" value="Muy en desacuerdo" required></td>
                    <td><input type="radio" name="seg_confianza" value="En desacuerdo"></td>
                    <td><input type="radio" name="seg_confianza" value="De acuerdo"></td>
                    <td><input type="radio" name="seg_confianza" value="Muy de acuerdo"></td></tr>
                <tr><td>Respuesta: Coordinaci贸n fluida con fuerzas policiales.</td>
                    <td><input type="radio" name="seg_respuesta" value="Muy en desacuerdo" required></td>
                    <td><input type="radio" name="seg_respuesta" value="En desacuerdo"></td>
                    <td><input type="radio" name="seg_respuesta" value="De acuerdo"></td>
                    <td><input type="radio" name="seg_respuesta" value="Muy de acuerdo"></td></tr>
                <tr><td>Incidencia: Demandas priorizadas por gesti贸n municipal.</td>
                    <td><input type="radio" name="seg_incidencia" value="Muy en desacuerdo" required></td>
                    <td><input type="radio" name="seg_incidencia" value="En desacuerdo"></td>
                    <td><input type="radio" name="seg_incidencia" value="De acuerdo"></td>
                    <td><input type="radio" name="seg_incidencia" value="Muy de acuerdo"></td></tr>
            </tbody>
        </table>
    </div>
</div>
<p class="leyenda-encuesta">(1- MUY EN DESACUERDO) (2. EN DESACUERDO) (3- DE ACUERDO) (4- MUY DE ACUERDO)</p>

<div class="encuesta-likert">
    <h3>2. Infraestructura y Gesti贸n Deportiva</h3>
    <div class="tabla-responsiva">
        <table>
            <thead><tr><th>Afirmaci贸n</th><th>1</th><th>2</th><th>3</th><th>4</th></tr></thead>
            <tbody>
                <tr><td>Infraestructura: Espacios deportivos en condiciones 贸ptimas.</td>
                    <td><input type="radio" name="dep_infra" value="Muy en desacuerdo" required></td>
                    <td><input type="radio" name="dep_infra" value="En desacuerdo"></td>
                    <td><input type="radio" name="dep_infra" value="De acuerdo"></td>
                    <td><input type="radio" name="dep_infra" value="Muy de acuerdo"></td></tr>
                <tr><td>Acceso: Participaci贸n garantizada sin exclusiones.</td>
                    <td><input type="radio" name="dep_acceso" value="Muy en desacuerdo" required></td>
                    <td><input type="radio" name="dep_acceso" value="En desacuerdo"></td>
                    <td><input type="radio" name="dep_acceso" value="De acuerdo"></td>
                    <td><input type="radio" name="dep_acceso" value="Muy de acuerdo"></td></tr>
                <tr><td>Prevenci贸n Social: Deporte aleja a j贸venes del riesgo.</td>
                    <td><input type="radio" name="dep_social" value="Muy en desacuerdo" required></td>
                    <td><input type="radio" name="dep_social" value="En desacuerdo"></td>
                    <td><input type="radio" name="dep_social" value="De acuerdo"></td>
                    <td><input type="radio" name="dep_social" value="Muy de acuerdo"></td></tr>
                <tr><td>Gesti贸n: Actividades f铆sicas constantes integradoras.</td>
                    <td><input type="radio" name="dep_gestion" value="Muy en desacuerdo" required></td>
                    <td><input type="radio" name="dep_gestion" value="En desacuerdo"></td>
                    <td><input type="radio" name="dep_gestion" value="De acuerdo"></td>
                    <td><input type="radio" name="dep_gestion" value="Muy de acuerdo"></td></tr>
            </tbody>
        </table>
    </div>
</div>
<p class="leyenda-encuesta">(1- MUY EN DESACUERDO) (2. EN DESACUERDO) (3- DE ACUERDO) (4- MUY DE ACUERDO)</p>

<div class="encuesta-likert">
    <h3>3. Cultura e Identidad Local</h3>
    <div class="tabla-responsiva">
        <table>
            <thead><tr><th>Afirmaci贸n</th><th>1</th><th>2</th><th>3</th><th>4</th></tr></thead>
            <tbody>
                <tr><td>Identidad: Rescate de historia y tradiciones locales.</td>
                    <td><input type="radio" name="cul_identidad" value="Muy en desacuerdo" required></td>
                    <td><input type="radio" name="cul_identidad" value="En desacuerdo"></td>
                    <td><input type="radio" name="cul_identidad" value="De acuerdo"></td>
                    <td><input type="radio" name="cul_identidad" value="Muy de acuerdo"></td></tr>
                <tr><td>Pertenencia: Orgullo y compromiso en festividades.</td>
                    <td><input type="radio" name="cul_pertenencia" value="Muy en desacuerdo" required></td>
                    <td><input type="radio" name="cul_pertenencia" value="En desacuerdo"></td>
                    <td><input type="radio" name="cul_pertenencia" value="De acuerdo"></td>
                    <td><input type="radio" name="cul_pertenencia" value="Muy de acuerdo"></td></tr>
                <tr><td>Fomento: Espacios para artistas y talentos locales.</td>
                    <td><input type="radio" name="cul_fomento" value="Muy en desacuerdo" required></td>
                    <td><input type="radio" name="cul_fomento" value="En desacuerdo"></td>
                    <td><input type="radio" name="cul_fomento" value="De acuerdo"></td>
                    <td><input type="radio" name="cul_fomento" value="Muy de acuerdo"></td></tr>
                <tr><td>Oferta: Talleres responden a intereses vecinales.</td>
                    <td><input type="radio" name="cul_oferta" value="Muy en desacuerdo" required></td>
                    <td><input type="radio" name="cul_oferta" value="En desacuerdo"></td>
                    <td><input type="radio" name="cul_oferta" value="De acuerdo"></td>
                    <td><input type="radio" name="cul_oferta" value="Muy de acuerdo"></td></tr>
            </tbody>
        </table>
    </div>
</div>

<p class="leyenda-encuesta">(1- MUY EN DESACUERDO) (2. EN DESACUERDO) (3- DE ACUERDO) (4- MUY DE ACUERDO)</p>

<div class="encuesta-likert">
    <h3>4. Percepci贸n de Seguridad Comunitaria</h3>
    <div class="tabla-responsiva">
        <table>
            <thead><tr><th>Afirmaci贸n</th><th>1</th><th>2</th><th>3</th><th>4</th></tr></thead>
            <tbody>
                <tr><td>Prevenci贸n: Red de comunicaci贸n (WhatsApp) efectiva.</td>
                    <td><input type="radio" name="per_prevencion" value="Muy en desacuerdo" required></td>
                    <td><input type="radio" name="per_prevencion" value="En desacuerdo"></td>
                    <td><input type="radio" name="per_prevencion" value="De acuerdo"></td>
                    <td><input type="radio" name="per_prevencion" value="Muy de acuerdo"></td></tr>
                <tr><td>Confianza: Vecinos denuncian problemas de convivencia.</td>
                    <td><input type="radio" name="per_confianza" value="Muy en desacuerdo" required></td>
                    <td><input type="radio" name="per_confianza" value="En desacuerdo"></td>
                    <td><input type="radio" name="per_confianza" value="De acuerdo"></td>
                    <td><input type="radio" name="per_confianza" value="Muy de acuerdo"></td></tr>
                <tr><td>Respuesta Inst.: Coordinaci贸n fluida con polic铆as.</td>
                    <td><input type="radio" name="per_respuesta" value="Muy en desacuerdo" required></td>
                    <td><input type="radio" name="per_respuesta" value="En desacuerdo"></td>
                    <td><input type="radio" name="per_respuesta" value="De acuerdo"></td>
                    <td><input type="radio" name="per_respuesta" value="Muy de acuerdo"></td></tr>
                <tr><td>Incidencia: Demandas priorizadas por el municipio.</td>
                    <td><input type="radio" name="per_incidencia" value="Muy en desacuerdo" required></td>
                    <td><input type="radio" name="per_incidencia" value="En desacuerdo"></td>
                    <td><input type="radio" name="per_incidencia" value="De acuerdo"></td>
                    <td><input type="radio" name="per_incidencia" value="Muy de acuerdo"></td></tr>
            </tbody>
        </table>
    </div>
</div>

    <div class="encuesta-seccion">
        <p class="pregunta-encuesta">驴Desea adjuntar fotos o documentos? (Opcional)</p>
        <label for="archivo-adjunto" class="custom-file-upload"> Seleccionar archivos</label>
        <input type="file" id="archivo-adjunto" name="mi_archivo" multiple accept="image/*,.pdf" onchange="mostrarPrevisualizacion()">
        <div id="vista-previa" class="contenedor-previa"></div>
    </div>

    <div class="area-acciones-final">
        <button type="submit" id="btn-enviar-todo" class="btn-principal">Enviar Todo</button>
        <button type="button" onclick="window.history.back();" class="btn-volver-final">Volver</button>
    </div>
  </form>
</section>

<script>
    const params = new URLSearchParams(window.location.search);
    const uv = params.get("uv") || "General";
    const dia = params.get("dia");
    const mes = params.get("mes");

    // 1. Configurar T铆tulo y Visualizaci贸n de fecha
    document.getElementById("titulo-formulario").innerText = `Formulario ${uv}`;
    
    if (dia && mes) {
        const fechaTexto = `${dia} de ${mes}`;
        // Muestra en pantalla
        document.getElementById("fecha-formulario").innerText = `Reporte para el ${fechaTexto}`;
        // GUARDA PARA EMAILJS (Muy importante)
        const inputOculto = document.getElementById("fecha_reporte_input");
        if(inputOculto) {
            inputOculto.value = fechaTexto;
        }
    }

    // 2. Mostrar secciones seg煤n UV
    if (uv.includes("24")) document.getElementById('seccion-uv24').style.display = 'block';
    if (uv.includes("25")) document.getElementById('seccion-uv25').style.display = 'block';
    if (uv.includes("26")) document.getElementById('seccion-uv26').style.display = 'block';

    // 3. Renderizar Horarios
    const grid = document.getElementById('contenedor-grid-horas');
    const bloques = ["17:00-18:00", "18:00-19:00", "19:00-20:00", "20:00-21:00", "21:00-22:00", "22:00-23:00"];
    grid.innerHTML = bloques.map(b => `
        <label class="hora-card">
            <input type="radio" name="hora_seleccionada" value="${b}" required>
            <div class="hora-contenido"><span> ${b}</span></div>
        </label>`).join('');

    // 4. Configuraci贸n EmailJS
    (function() { 
        emailjs.init("tZHnpxwzmP21nalv9"); 
    })();

    document.getElementById('form-reclamo').addEventListener('submit', function(event) {
        event.preventDefault();
        
        const btn = document.getElementById('btn-enviar-todo');
        btn.innerText = 'Enviando Reporte...';
        btn.disabled = true;

        // Enviamos el formulario completo (incluyendo el input oculto de fecha)
        emailjs.sendForm('service_njjh059', 'template_o82hbxi', this)
            .then(() => {
                alert('隆xito! El formulario se envi贸 con la fecha: ' + document.getElementById("fecha_reporte_input").value);
                this.reset();
                btn.innerText = 'Enviar Todo';
            })
            .catch((err) => {
                alert('Error: ' + JSON.stringify(err));
                btn.innerText = 'Reintentar';
            })
            .finally(() => {
                btn.disabled = false;
            });
    });
</script>
</body>
</html>
